#! /usr/bin/env python3
# Plot CVE data in csv files created by query.py
# matplotlib version
import argparse, datetime, json
import matplotlib.pyplot as plt # https://matplotlib.org
import numpy as np # https://numpy.org/doc

parser = argparse.ArgumentParser(
    prog='tba',
    description='Plot charts of CVE data from CSV files.')

#parser.add_argument('--start', '-s', help='Start year (inclusive)', default=2002, type=int)
#parser.add_argument('--end', '-e', help='End year (inclusive)',  default=datetime.datetime.now().year, type=int)
## parser.add_argument('--dbport', help='Local CouchDB port number', default='5984', type=int)
#parser.add_argument('--dbuser', '-u', help='CouchDB admin username', default='admin')
#parser.add_argument('--dbpass', '-p', help='CouchDB admin password', default='password')
#parser.add_argument('--dbname', '-n', help='CouchDB database name', default='nvd')

global args
args = vars(parser.parse_args())


if __name__ == '__main__':

    # TODO for each CSV file
    df = pd.read_csv('test.csv', index_col=0)

    # TODO Common gnuplot params
    # gnuplot.plot_data(df, 'using 3:2 with boxes t "All Severities"', output = '"test.png"', terminal = 'pngcairo font "arial,10"', xrange = '[*:*]', yrange = '[0:*]', boxwidth = '0.8 relative', style = 'fill solid 0.5', xtics = '1', autoscale = 'y', title = '"Linux Kernel CVEs by Year"', xlabel = '"Year"', ylabel = '"Number of CVEs"', key = 'top right' )


    gnuplot.plot_data(df, 'u ($2):xtic(1) t col, "" u ($3):xtic(1) t col, "" u ($4):xtic(1) t col, "" u ($0-1):($2+10):(sprintf("%d",$2)) with labels t "", "" u ($0-1):($2+$3+10):(sprintf("%d",$3)) with labels t "", "" u ($0-1):($2+$3+$4+10):(sprintf("%d",$4)) with labels t ""', output = '"test.png"', terminal = 'pngcairo font "arial,10" size 800, 600', xrange = '[*:*]', yrange = '[0:*]', boxwidth = '0.8 relative', style = ['data histograms', 'histogram rowstacked', 'fill solid 0.5'], xtics = '1', autoscale = 'y', title = '"Linux Kernel CVEs"', xlabel = '"Year"', ylabel = '"Number of CVEs"', key = 'top right title "Severity"' )
