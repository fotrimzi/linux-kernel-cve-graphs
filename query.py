#! /usr/bin/env python3
import couchdb, json, pathlib

server = 'http://admin:password@localhost:5984'
database = 'nvd'

# Load queries from JSON file. Access query by key (e.g. query_0)
query_file = 'queries.json'
queries = json.loads(pathlib.Path(query_file).read_text())

query_name = 'query_0'

query_server = couchdb.client.Server(server)
query_database = query_server[database]

print(f"Running query {query_name}")
# TODO Queries with variable parameters
query_result = query_database.find(queries[query_name])
count = 0
for r in query_result:
    count+=1
    print(f"{count} ",  r['cve']['CVE_data_meta']['ID'])

query_result_list = [r['cve']['CVE_data_meta']['ID'] for r in query_result]
print(len(query_result_list))

#    db.destroy()
